<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 ILAE Epilepsy Classifier & Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#003366',
              secondary: '#e6b800',
              accent: '#f4f7f6',
              success: '#27ae60',
              warning: '#f39c12',
              danger: '#c0392b',
            },
            animation: {
              'fade-in': 'fadeIn 0.3s ease-in-out',
              'slide-up': 'slideUp 0.4s ease-out',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              },
              slideUp: {
                '0%': { transform: 'translateY(20px)', opacity: '0' },
                '100%': { transform: 'translateY(0)', opacity: '1' },
              }
            }
          }
        }
      }
    </script>
    <style>
      body {
        -webkit-tap-highlight-color: transparent;
        background-color: #f4f7f6;
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #f1f1f1; }
      ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #a0aec0; }
      
      .view-section { display: none; }
      .view-section.active { display: block; }
    </style>
</head>
<body class="bg-accent text-slate-800 font-sans min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-primary text-white p-4 shadow-md z-10 sticky top-0">
        <div class="max-w-4xl mx-auto flex items-center justify-between relative">
            <button id="homeBtn" onclick="navigateTo('landing')" class="hidden text-white/80 hover:text-white font-bold text-sm px-3 py-1 border border-white/30 rounded flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                Home
            </button>
            <div class="text-center w-full">
                <h1 class="text-xl md:text-2xl font-bold tracking-tight">2025 ILAE Classification Tool</h1>
                <div class="text-xs text-gray-300 mt-1 font-light italic">
                    Developed by Fawzi Babtain, MBBS, FRCPC, CSCN
                </div>
            </div>
            <div class="w-16"></div> <!-- Spacer for centering -->
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 p-4 md:p-6 overflow-y-auto">
        <div class="max-w-4xl mx-auto">
            
            <!-- LANDING SCREEN -->
            <div id="landing" class="view-section active animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                    <div onclick="navigateTo('classifier')" class="bg-white rounded-xl p-8 shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer border-t-4 border-primary group">
                        <div class="text-5xl mb-4 group-hover:scale-110 transition-transform duration-200">üß†</div>
                        <h3 class="text-2xl font-bold text-primary mb-3">Epilepsy Classifier</h3>
                        <p class="text-slate-500 text-lg leading-relaxed">
                            Classify seizures using the 2025 ILAE Basic & Expanded framework. Specialized analysis for eye and head deviation sequences.
                        </p>
                    </div>

                    <div onclick="navigateTo('quiz')" class="bg-white rounded-xl p-8 shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer border-t-4 border-secondary group">
                        <div class="text-5xl mb-4 group-hover:scale-110 transition-transform duration-200">üìù</div>
                        <h3 class="text-2xl font-bold text-primary mb-3">Test Your Knowledge</h3>
                        <p class="text-slate-500 text-lg leading-relaxed">
                            Interactive clinical scenarios. Choose between ILAE 2025 Classification and Seizure Semiology localization modules.
                        </p>
                    </div>
                </div>
            </div>

            <!-- CLASSIFIER SCREEN -->
            <div id="classifier" class="view-section animate-fade-in">
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <label class="block text-primary font-bold mb-3 text-lg">Enter Seizure Description:</label>
                    <textarea id="seizureInput"
                        class="w-full h-40 p-4 border-2 border-slate-200 rounded-lg focus:border-primary focus:outline-none focus:ring-0 text-lg resize-y mb-4 transition-colors"
                        placeholder="Example: Patient describes palpitations followed by lip smacking, head and eyes turned to the left, and stiffening of the left arm..."></textarea>
                    <button onclick="runClassification()" 
                        class="w-full bg-primary hover:bg-blue-900 text-white font-bold py-4 rounded-lg text-lg transition-colors shadow-md active:scale-[0.99]">
                        Classify (ILAE 2025)
                    </button>
                </div>

                <div id="resultContainer" class="hidden bg-white rounded-xl shadow-lg border border-slate-100 overflow-hidden animate-slide-up">
                    <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                        <span class="text-xs font-bold tracking-widest text-slate-400 uppercase">Basic Classification</span>
                        <div id="basicResult" class="text-2xl font-bold text-primary mt-1"></div>
                        <div id="gtcWarning" class="hidden mt-3 bg-yellow-50 text-yellow-800 p-3 rounded-lg text-sm border border-yellow-200">
                            <strong>Clinical Note:</strong> Tonic-clonic seizures carry the highest risk of injury and SUDEP regardless of onset type.
                        </div>
                    </div>

                    <div class="p-6 border-b border-slate-100">
                        <span class="text-xs font-bold tracking-widest text-slate-400 uppercase">Expanded Classification</span>
                        <div id="expandedResult" class="text-lg font-medium text-slate-700 mt-2 leading-relaxed"></div>
                        <p class="text-sm text-slate-400 mt-2 italic">* Arrows (‚ûî) indicate chronological sequence.</p>
                    </div>

                    <div class="p-6">
                        <span class="text-xs font-bold tracking-widest text-slate-400 uppercase">Lateralizing Signs</span>
                        <ul id="lateralizationList" class="mt-4 space-y-1"></ul>
                    </div>
                </div>
            </div>

            <!-- QUIZ SCREEN -->
            <div id="quiz" class="view-section animate-fade-in h-full">
                
                <!-- Quiz Selection Menu -->
                <div id="quizMenu" class="h-full">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-primary">Select Assessment Module</h2>
                        <p class="text-slate-500 mt-2">Choose a specialized module to test your diagnostic skills.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Module 1 -->
                        <div onclick="startQuiz('classification')" class="bg-white rounded-xl p-8 shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer border-l-8 border-secondary group relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity">
                                <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                            </div>
                            <h3 class="text-xl font-bold text-primary mb-2 flex items-center gap-2">
                                <span>üìã</span> ILAE Classification Test
                            </h3>
                            <p class="text-slate-500 text-sm mb-4">Focuses on the 2025 framework, seizure types, and consciousness states.</p>
                        </div>

                        <!-- Module 2 -->
                        <div onclick="startQuiz('semiology')" class="bg-white rounded-xl p-8 shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer border-l-8 border-primary group relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity">
                                <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                            </div>
                            <h3 class="text-xl font-bold text-primary mb-2 flex items-center gap-2">
                                <span>üéØ</span> Seizure Semiology Test
                            </h3>
                            <p class="text-slate-500 text-sm mb-4">Focuses on localization, lateralization, and brain regions.</p>
                        </div>
                    </div>
                </div>

                <!-- Active Quiz Interface -->
                <div id="quizActive" class="hidden flex flex-col h-full">
                    <div class="flex-1 bg-white rounded-xl shadow-lg p-6 md:p-8 flex flex-col relative">
                        
                        <!-- Top Bar -->
                        <div class="flex justify-between items-center mb-6 pb-4 border-b border-slate-100">
                            <button onclick="showQuizMenu()" class="text-slate-400 hover:text-primary text-sm font-bold flex items-center gap-1">
                                ‚Üê Modules
                            </button>
                            <span id="quizTitle" class="text-sm font-bold text-primary uppercase tracking-wider bg-primary/5 px-3 py-1 rounded"></span>
                            <span id="qStreak" class="text-sm font-bold text-secondary">Streak: 0 üî•</span>
                        </div>

                        <!-- Question Area -->
                        <div class="flex flex-col flex-1">
                            <div class="mb-2">
                                <span id="qCount" class="text-xs font-bold text-slate-400 uppercase tracking-widest">Question 1</span>
                            </div>
                            
                            <h3 id="qText" class="text-xl font-bold text-slate-800 mb-8 leading-relaxed"></h3>

                            <div id="qOptions" class="space-y-3 flex-1 overflow-y-auto"></div>

                            <div id="qFeedback" class="hidden mt-6 pt-6 border-t border-slate-100 flex justify-between items-center animate-slide-up">
                                <div id="feedbackText" class="text-lg font-bold"></div>
                                <button onclick="nextQuestion()" class="bg-primary text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-900 transition-colors">Next</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script>
        // --- NAVIGATION LOGIC ---
        function navigateTo(screenId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            const homeBtn = document.getElementById('homeBtn');
            if (screenId === 'landing') {
                homeBtn.classList.add('hidden');
                // Reset Quiz View if returning home
                showQuizMenu();
            } else {
                homeBtn.classList.remove('hidden');
            }
            window.scrollTo(0, 0);
        }

        function showQuizMenu() {
            document.getElementById('quizMenu').classList.remove('hidden');
            document.getElementById('quizActive').classList.add('hidden');
        }

        // --- ILAE CLASSIFICATION LOGIC (CLASSIFIER) ---
        
        // Dictionary Definition
        const dictionary = [
            // --- Specific Eye/Head Logic (Priority High) ---
            { keys: ["head and eye", "eyes and head", "head and eyes"], term: "Head and eye deviation", cat: "Versive seizure", type: "ictal_side_both", subtype: "versive" },
            { keys: ["head turn", "head deviat", "head version", "head to"], term: "Head deviation", cat: "Versive seizure", type: "ictal_side_head", subtype: "versive" },
            { keys: ["eye deviat", "eyes deviat", "eyes turn", "eyes look", "looking to", "gaze"], term: "Eye deviation", cat: "Versive seizure", type: "ictal_side_eyes", subtype: "versive" },

            // --- AURAS ---
            { keys: ["epigast", "stomach", "rising", "nausea", "abdominal", "butterfl", "belli"], term: "Abdominal rising sensation", cat: "Autonomic Aura", type: "aura", subtype: "autonomic" },
            { keys: ["palpitat", "heart", "tachycardia"], term: "Palpitations", cat: "Autonomic Aura", type: "aura", subtype: "autonomic" },
            { keys: ["chest tight", "breath"], term: "Chest tightness", cat: "Autonomic Aura", type: "aura", subtype: "autonomic" },
            { keys: ["visu", "blur", "flash", "light", "spot", "color", "hallucinat", "blind", "vision", "seeing", "multicolor", "hemifield"], term: "Visual hallucinations/flashes", cat: "Visual Aura", type: "aura", subtype: "visual" },
            { keys: ["distort", "micropsia", "macropsia"], term: "Visual distortions", cat: "Visual Aura", type: "aura", subtype: "visual" },
            { keys: ["tingl", "numb", "pin", "needle", "electric"], term: "Paresthesia (tingling/numbness)", cat: "Somatosensory Aura", type: "aura", subtype: "somatosensory" },
            { keys: ["pain", "burn", "hurt"], term: "Somatic pain", cat: "Somatosensory Aura", type: "aura", subtype: "somatosensory" },
            { keys: ["auditory", "hearing voice", "heard voice", "buzz", "ringing", "music"], term: "Auditory hallucinations/buzzing", cat: "Auditory Aura", type: "aura", subtype: "auditory" },
            { keys: ["deja", "d√©j√†"], term: "D√©j√† vu", cat: "Cognitive Aura", type: "aura", subtype: "cognitive" },
            { keys: ["jamais"], term: "Jamais vu", cat: "Cognitive Aura", type: "aura", subtype: "cognitive" },
            { keys: ["dream", "detach", "realiti", "derealiz"], term: "Derealization feeling", cat: "Cognitive Aura", type: "aura", subtype: "cognitive" },
            { keys: ["depersonaliz", "out of body"], term: "Depersonalization", cat: "Cognitive Aura", type: "aura", subtype: "cognitive" },
            { keys: ["anxi", "panic", "nervous"], term: "Anxiety", cat: "Emotional Aura", type: "aura", subtype: "emotional" },
            { keys: ["fear", "scared", "terrified"], term: "Fear", cat: "Emotional Aura", type: "aura", subtype: "emotional" },
            { keys: ["joy", "ecsta", "bliss", "euphoria"], term: "Pleasant euphoria", cat: "Emotional Aura", type: "aura", subtype: "emotional" },
            { keys: ["sadness", "depress", "crying", "dacrystic"], term: "Sudden sadness", cat: "Emotional Aura", type: "aura", subtype: "emotional" },
            { keys: ["aura", "funny feel", "strange sensation", "vague sensation", "indescribable", "poorly described"], term: "Indescribable aura", cat: "Nonspecific Aura", type: "aura_generic", subtype: "focal" },

            // --- ICTAL ---
            { keys: ["flush", "hot", "warm", "sweat"], term: "Heat flushing/Sweating", cat: "Autonomic signs", type: "ictal", subtype: "autonomic" },
            { keys: ["goosebump", "piloerect", "hair stand"], term: "Piloerection", cat: "Autonomic signs", type: "ictal", subtype: "autonomic" },
            { keys: ["pallor"], term: "Pallor", cat: "Autonomic signs", type: "ictal", subtype: "autonomic" },
            { keys: ["speech arrest", "can't speak", "unable to speak", "aphas", "paraphas", "word finding"], term: "Speech arrest/Aphasia", cat: "Aphasic seizure", type: "ictal", subtype: "aphasic" },
            { keys: ["laugh", "gelastic", "giggle"], term: "Gelastic (Laughter)", cat: "Emotional (Gelastic)", type: "ictal", subtype: "emotional" },
            { keys: ["lip", "smack", "chew", "swallow", "lick"], term: "Lip smacking/Chewing", cat: "Oroalimentary automatisms", type: "ictal", subtype: "automotor" },
            { keys: ["fumb", "pick", "undress", "rub", "manual", "grasp", "fidget", "manipulat"], term: "Hand fumbling/picking", cat: "Manual automatisms", type: "ictal", subtype: "automotor" },
            { keys: ["walk", "run", "wander", "bicyc", "pedal", "thrash", "agitated", "hypermotor"], term: "Hyperkinetic movements", cat: "Hyperkinetic", type: "ictal", subtype: "hypermotor" },
            { keys: ["stif", "rigid", "tonic", "postur"], term: "Tonic stiffening", cat: "Tonic seizure", type: "ictal_tonic", subtype: "tonic" },
            { keys: ["figure of 4", "figure of four"], term: "Figure of 4 posturing", cat: "Asymmetric dystonic posturing", type: "ictal", subtype: "tonic" },
            { keys: ["fenc"], term: "Fencing posture", cat: "Asymmetric tonic", type: "ictal", subtype: "tonic" },
            { keys: ["dystoni"], term: "Dystonic posturing", cat: "Dystonia", type: "ictal_dystonia", subtype: "tonic" },
            
            { keys: ["clonic", "jerk", "twitch", "shak"], term: "Clonic jerking", cat: "Clonic seizure", type: "ictal", subtype: "clonic" },
            { keys: ["myoclon", "shock", "lightn"], term: "Myoclonic jerks", cat: "Myoclonic seizure", type: "ictal", subtype: "myoclonic" },
            { keys: ["eyelid", "blink", "flutter"], term: "Eyelid myoclonia", cat: "Eyelid myoclonia", type: "ictal", subtype: "myoclonic" },
            { keys: ["atonic", "drop", "fall", "limp", "loss of tone", "nod", "unable to move", "negative motor"], term: "Atonic/Negative motor", cat: "Atonic seizure", type: "ictal", subtype: "atonic" },
            { keys: ["spasm", "jackknife"], term: "Epileptic spasms", cat: "Epileptic spasms", type: "ictal", subtype: "epileptic spasm" },
            { keys: ["arrest", "paus", "freez", "stare", "staring", "blank", "motionless"], term: "Behavioral arrest/Staring", cat: "Behavioral arrest", type: "ictal_stare", subtype: "focal" },
            { keys: ["vomit", "emesis"], term: "Ictal vomiting", cat: "Autonomic (Vomiting)", type: "ictal", subtype: "autonomic" },
            { keys: ["scream", "shout", "vocaliz", "cry", "crying"], term: "Ictal cry/Vocalization", cat: "Vocalization", type: "ictal", subtype: "vocalization" },
            { keys: ["pout", "chapeau"], term: "Ictal pouting (chapeau de gendarme)", cat: "Motor signs", type: "ictal", subtype: "motor" },
            { keys: ["tonic clonic", "tonic-clonic", "grand mal", "convuls", "btc", "fbtc"], term: "Bilateral tonic-clonic convulsions", cat: "Bilateral tonic-clonic", type: "ictal_gtc", subtype: "tonic-clonic" },

            // --- POSTICTAL ---
            { keys: ["confus", "disorient", "reorient"], term: "Postictal confusion", cat: "Postictal", type: "postictal", subtype: "none" },
            { keys: ["sleep", "drowsy", "tired"], term: "Postictal sleep", cat: "Postictal", type: "postictal", subtype: "none" },
            { keys: ["weakness", "paresis", "paralysis", "hemiparesis"], term: "Postictal paresis", cat: "Postictal", type: "postictal", subtype: "none" },
            { keys: ["nose wip", "wip"], term: "Nose wiping", cat: "Postictal", type: "postictal", subtype: "none" }
        ];

        function extractSide(text, index) {
            const contextWindow = 50; 
            const start = Math.max(0, index - contextWindow);
            const end = Math.min(text.length, index + contextWindow);
            const substring = text.substring(start, end).toLowerCase();
            if (substring.includes("right")) return "right";
            if (substring.includes("left")) return "left";
            return "";
        }

        function isNegated(text, index) {
            const contextStart = Math.max(0, index - 25); 
            const context = text.substring(contextStart, index).toLowerCase();
            const negations = ["no ", "without ", "denies ", "did not have ", "absence of "];
            const trimmedContext = context.trim();
            for (let neg of negations) {
                if (trimmedContext.endsWith(neg.trim())) return true;
            }
            return false;
        }

        function check(text, keywords) {
            return keywords.some(k => text.includes(k));
        }

        function runClassification() {
            const rawText = document.getElementById('seizureInput').value;
            if (!rawText.trim()) return;
            const text = rawText.toLowerCase();

            // 1. Find all potential matches
            let allMatches = [];
            let hasSpecificAura = false;
            
            // Check specific aura first for global context
            dictionary.forEach(entry => {
                if (entry.type === "aura" && entry.subtype !== "focal") {
                    if (entry.keys.some(k => text.includes(k) && !isNegated(text, text.indexOf(k)))) {
                        hasSpecificAura = true;
                    }
                }
            });

            dictionary.forEach(entry => {
                entry.keys.forEach(key => {
                    let searchPos = 0;
                    while (true) {
                        const idx = text.indexOf(key, searchPos);
                        if (idx === -1) break;
                        
                        if (!isNegated(text, idx) && !(entry.type === "aura_generic" && hasSpecificAura)) {
                             // Extract side once
                             const side = extractSide(text, idx);
                             let finalTerm = entry.term;

                             // Logic for specific types
                             if (entry.type === "ictal_side_both") {
                                 finalTerm = side ? `Head and eye deviation to the ${side}` : "Head and eye deviation";
                             } else if (entry.type === "ictal_side_head") {
                                 finalTerm = side ? `Head deviation to the ${side}` : "Head deviation";
                             } else if (entry.type === "ictal_side_eyes") {
                                 finalTerm = side ? `Eye deviation to the ${side}` : "Eye deviation";
                             } else if (entry.type === "ictal_dystonia") {
                                 if (side) finalTerm = `${side.charAt(0).toUpperCase() + side.slice(1)} arm posturing`;
                             } else if (entry.type === "ictal_tonic") {
                                 if (side && !finalTerm.includes("stiffening")) finalTerm = `${side.charAt(0).toUpperCase() + side.slice(1)} arm tonic`;
                             } else if (entry.cat === "Clonic seizure" && side) {
                                 finalTerm = `Clonic jerking of the ${side} side`;
                             }

                             if (key === "unable to move" || key === "negative motor") finalTerm = "Negative motor phenomenon";

                             allMatches.push({
                                 start: idx,
                                 end: idx + key.length,
                                 term: finalTerm,
                                 cat: entry.cat,
                                 type: entry.type,
                                 subtype: entry.subtype
                             });
                        }
                        searchPos = idx + 1;
                    }
                });
            });

            // 2. Handle Asymmetric Tonic (Ext/Flex) logic separate detection
            const hasExt = check(text, ["exten"]);
            const hasFlex = check(text, ["flex"]);
            if (hasExt || hasFlex) {
                let phrase = "";
                let extSide = "";
                let flexSide = "";
                const extIdx = text.indexOf("exten");
                if (extIdx !== -1 && !isNegated(text, extIdx)) extSide = extractSide(text, extIdx);
                const flexIdx = text.indexOf("flex");
                if (flexIdx !== -1 && !isNegated(text, flexIdx)) flexSide = extractSide(text, flexIdx);
                
                if (hasExt && hasFlex) {
                    let parts = [];
                    if (extSide) parts.push(`extension of ${extSide} arm`);
                    else parts.push("extension of arm");
                    if (flexSide) parts.push(`flexion of ${flexSide} arm`);
                    else parts.push("flexion of arm");
                    phrase = `Asymmetric posturing with ${parts.join(", ")}`;
                } else if (hasExt) {
                    phrase = extSide ? `Extension of ${extSide} arm` : "Tonic extension";
                } else if (hasFlex) {
                    phrase = flexSide ? `Flexion of ${flexSide} arm` : "Tonic flexion";
                }
                
                if (phrase) {
                     const idx = extIdx !== -1 ? extIdx : flexIdx;
                     allMatches.push({
                        start: idx,
                        end: idx + 5, // approx
                        term: phrase,
                        cat: "Asymmetric tonic",
                        type: "ictal",
                        subtype: "tonic"
                     });
                }
            }

            // 3. Filter overlaps (Longest wins)
            allMatches.sort((a, b) => (b.end - b.start) - (a.end - a.start));
            let acceptedMatches = [];
            
            allMatches.forEach(m => {
                // Check if this match overlaps with any accepted match
                const isOverlapping = acceptedMatches.some(acc => {
                    return (m.start < acc.end && m.end > acc.start);
                });
                if (!isOverlapping) {
                    // Check for duplicate terms (e.g. found "head turn" twice)
                    if (!acceptedMatches.some(acc => acc.term === m.term)) {
                        acceptedMatches.push(m);
                    }
                }
            });

            acceptedMatches.sort((a, b) => a.start - b.start);

            // 4. Determine Classification
            let onset = "Unknown";
            let isFocal = false;

            if (check(text, ["focal", "aura", "epigast", "one side", "right", "left", "hemi", "unilateral", "asymmetric", "automat", "lip smack", "start", "onset", "version", "versive", "postur", "flex", "exten", "visual", "auditory", "taste", "smell", "feeling", "sensation"])) {
                onset = "Focal";
                isFocal = true;
            }
            if (check(text, ["generalized", "generalised", "absence", "3hz", "myoclon", "bilateral synchronous", "all limb", "whole body"])) {
                if (!isFocal || check(text, ["absence", "juvenile", "jme", "cae"])) onset = "Generalized";
            }

            let consciousness = "Preserved";
            if (check(text, ["unrespon", "unrepon", "no recal", "amne", "confus", "lost", "blank", "passed out", "unconscious", "impaired", "unaware", "loss of awareness", "stare", "staring", "no respon", "not respon", "lapse of awareness", "behavioral arrest"])) {
                consciousness = "Impaired";
            }

            let hasObservable = false;
            const hasMotorSigns = acceptedMatches.some(m => m.type.startsWith("ictal"));
            if (hasMotorSigns || consciousness === "Impaired") hasObservable = true;
            if (acceptedMatches.every(m => m.type.startsWith("aura")) && consciousness === "Preserved") hasObservable = false;

            let evolvesToBTC = false;
            if (acceptedMatches.some(m => m.type === "ictal_gtc") || check(text, ["secondary gen", "spread to bilat", "convuls", "fbtc"])) {
                evolvesToBTC = true;
            }

            // Focal-to-Bilateral Logic
            if (isFocal && evolvesToBTC) onset = "Focal";
            else if (evolvesToBTC && (text.includes(" then ") || text.includes("followed by"))) {
                onset = "Focal";
                isFocal = true;
            } else if (!isFocal && evolvesToBTC && onset !== "Generalized") {
                onset = "Unknown";
            }

            // Subtype Naming
            let subtypeName = "";
            const motorTypes = ["hypermotor", "gelastic", "aphasic", "epileptic spasm", "atonic", "myoclonic", "clonic", "tonic"];
            for (let type of motorTypes) {
                if (acceptedMatches.some(m => m.subtype === type || (m.cat && m.cat.toLowerCase().includes(type)))) {
                    subtypeName = type;
                    if (subtypeName === "gelastic") subtypeName = "emotional";
                    if (subtypeName === "negative motor") subtypeName = "negative motor";
                    break;
                }
            }
            if (!subtypeName && onset === "Focal") {
                const auraTypes = ["autonomic", "visual", "somatosensory", "auditory", "cognitive", "emotional"];
                for (let type of auraTypes) {
                    if (acceptedMatches.some(m => m.subtype === type)) {
                        subtypeName = type;
                        break;
                    }
                }
            }
            if (subtypeName) {
                if (subtypeName === "automotor") subtypeName = "";
                else subtypeName += " ";
            }

            // BASIC Output construction
            let basicClass = "";
            if (onset === "Generalized") {
                let genType = "Seizure (Unspecified)";
                if (check(text, ["absence"])) genType = "Absence Seizure";
                else if (check(text, ["myoclon"]) && !check(text, ["tonic"])) genType = "Myoclonic Seizure";
                else if (check(text, ["tonic"]) && !check(text, ["clonic"])) genType = "Tonic Seizure";
                else if (check(text, ["atonic"])) genType = "Atonic Seizure";
                else if (check(text, ["negative"])) genType = "Epileptic Negative Myoclonus Seizure";
                else if (evolvesToBTC) genType = "Tonic-Clonic Seizure";
                basicClass = `Generalized ${genType.toLowerCase()} with observable manifestations.`;
            } else if (onset === "Focal") {
                let consString = (consciousness === "Impaired") ? "impaired-consciousness" : "preserved-consciousness";
                let obsString = hasObservable ? "with observable manifestations" : "without observable manifestations";
                if (evolvesToBTC) basicClass = "Focal-to-bilateral tonic-clonic seizure.";
                else basicClass = `Focal ${consString} seizure ${obsString}.`;
            } else {
                if (evolvesToBTC) basicClass = "Tonic-clonic seizure, unknown whether focal or generalized.";
                else if (check(text, ["blank spell", "stare"])) basicClass = "Seizure unknown whether focal or generalized, with unknown state of consciousness.";
                else basicClass = "Unclassified seizure.";
            }

            // EXPANDED Output
            let expandedString = "";
            let consExp = (consciousness === "Impaired") ? "impaired-consciousness" : "preserved-consciousness";
            if (onset === "Focal") {
                if (evolvesToBTC) expandedString = "Focal-to-bilateral tonic-clonic seizure";
                else expandedString = `Focal ${consExp} ${subtypeName}seizure`;
            } else {
                if (onset === "Unknown" && evolvesToBTC) expandedString = "Seizure unknown whether focal or generalized ‚Äì bilateral tonic-clonic seizure";
                else {
                    expandedString = basicClass.replace(/\.$/, "");
                    expandedString = expandedString.split(" with observable")[0];
                }
            }

            let sequenceList = acceptedMatches.map(m => {
                let desc = `${m.term} (${m.cat})`;
                if (m.cat.includes("Aura")) desc = m.term + " (" + m.cat.toLowerCase() + ")";
                if (m.cat === "Oroalimentary automatisms") desc = m.term + " (oroalimentary automatisms)";
                if (["ictal_side_both", "ictal_side_head", "ictal_side_eyes", "ictal_dystonia", "postictal"].includes(m.type) || m.cat === "Asymmetric tonic" || m.type.startsWith("ictal")) {
                    desc = m.term;
                }
                return desc;
            });

            if (sequenceList.length > 0) {
                if (evolvesToBTC) sequenceList = sequenceList.filter(s => !s.toLowerCase().includes("bilateral tonic-clonic"));
                if (onset === "Unknown" && evolvesToBTC && sequenceList.length > 0) expandedString += ": " + sequenceList.join(", ");
                else expandedString += " with the following manifestations: " + sequenceList.join(" ‚ûî ");
            } else if (onset !== "Unknown" || !evolvesToBTC) {
                expandedString += " (Insufficient semiology detected)";
            }
            expandedString += ".";

            // Lateralization
            let lateralizingSigns = [];
            acceptedMatches.forEach(m => {
                const t = m.term.toLowerCase();
                if (t.includes('left')) lateralizingSigns.push(`${m.term} (Indicates Right Hemisphere for motor/sensory)`);
                else if (t.includes('right')) lateralizingSigns.push(`${m.term} (Indicates Left Hemisphere for motor/sensory)`);
                else if (m.cat.includes('Visual')) lateralizingSigns.push(`${m.term} (Contralateral Occipital)`);
                else if (m.cat.includes('Somatosensory')) lateralizingSigns.push(`${m.term} (Contralateral Post-Central)`);
                else if (m.cat.includes('Auditory')) lateralizingSigns.push(`${m.term} (Superior Temporal)`);
                else if (m.type.startsWith('ictal_side')) lateralizingSigns.push(`${m.term} (Versive - Contralateral Frontal)`);
            });

            // Render
            document.getElementById('basicResult').textContent = basicClass;
            document.getElementById('expandedResult').textContent = expandedString;
            
            const latList = document.getElementById('lateralizationList');
            latList.innerHTML = '';
            if (lateralizingSigns.length > 0) {
                lateralizingSigns.forEach(sign => {
                    const li = document.createElement('li');
                    li.className = "text-slate-600 text-sm flex items-start";
                    li.innerHTML = `<span class="mr-2 text-primary">‚Ä¢</span>${sign}`;
                    latList.appendChild(li);
                });
            } else {
                latList.innerHTML = '<li class="text-slate-400 italic">No definite lateralizing signs detected.</li>';
            }

            document.getElementById('gtcWarning').classList.toggle('hidden', !basicClass.toLowerCase().includes('tonic-clonic'));
            document.getElementById('resultContainer').classList.remove('hidden');
        }

        // --- QUIZ DATA ---
        
        const classificationCases = [
            { q: "A 24-year-old patient reports a sudden 'rising sensation' in the stomach. He remains fully aware and can speak during the event. No other movements occur.", a: "Focal Seizure with Preserved Consciousness (Autonomic)", opts: ["Focal Seizure with Impaired Consciousness (Motor)", "Generalized Non-Motor Seizure (Absence)", "Focal Seizure with Preserved Consciousness (Motor)"] },
            { q: "Patient suddenly stops activity, stares blankly, and performs repetitive chewing movements (oral automatism). He does not respond to questions. Event lasts 45 seconds.", a: "Focal Seizure with Impaired Consciousness (Automatism)", opts: ["Focal Seizure with Preserved Consciousness (Sensory)", "Generalized Seizure with Absences (Atypical)", "Focal Seizure with Preserved Consciousness (Tonic)"] },
            { q: "During sleep, the patient exhibits explosive, hyperkinetic thrashing of both legs and pelvic thrusting. Duration is 15 seconds.", a: "Focal Motor Seizure (Hyperkinetic)", opts: ["Generalized Tonic-Clonic Seizure (Convulsive)", "Focal Non-Motor Seizure (Behavioral)", "Generalized Non-Motor Seizure (Absence)"] },
            { q: "Patient sees flashing colored lights in the right visual field for 10 seconds, remains fully aware.", a: "Focal Seizure with Preserved Consciousness (Visual)", opts: ["Focal Seizure with Impaired Consciousness (Visual)", "Generalized Sensory Seizure (Visual)", "Focal Motor Seizure (Clonic)"] },
            { q: "Sudden onset of rigid stiffening of the left arm and leg while awake. Awareness is preserved.", a: "Focal Motor Seizure (Tonic)", opts: ["Generalized Tonic Seizure (Bilateral)", "Focal Seizure with Impaired Consciousness", "Focal Motor Seizure (Atonic)"] },
            { q: "A child has a 5-second episode of staring with immediate recovery. Provoked by hyperventilation.", a: "Generalized Non-Motor Seizure (Absence)", opts: ["Focal Seizure with Impaired Consciousness (Cognitive)", "Focal Motor Seizure (Arrest)", "Generalized Motor Seizure (Tonic)"] },
            { q: "Patient has a sudden loss of muscle tone and falls to the ground. Recovery is immediate.", a: "Generalized (or Focal) Atonic Seizure", opts: ["Focal Motor Seizure (Tonic)", "Generalized Tonic-Clonic Seizure", "Focal Seizure with Impaired Consciousness"] },
            { q: "Patient experiences sudden intense fear and panic without context, fully aware.", a: "Focal Seizure with Preserved Consciousness (Emotional)", opts: ["Focal Seizure with Impaired Consciousness (Emotional)", "Non-Epileptic Panic Attack", "Focal Motor Seizure (Hyperkinetic)"] },
            { q: "Rhythmic jerking starts in the right thumb and spreads up the arm to the face. Awareness is preserved.", a: "Focal Motor Seizure (Clonic - Jacksonian)", opts: ["Focal Seizure with Impaired Consciousness", "Generalized Clonic Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Patient wakes up with a bitten tongue and muscle soreness. Partner reports generalized stiffening followed by shaking.", a: "Focal to Bilateral Tonic-Clonic Seizure", opts: ["Focal Motor Seizure (Hyperkinetic)", "Generalized Myoclonic Seizure", "Focal Seizure with Preserved Consciousness"] },
            { q: "Sudden inability to speak (speech arrest) but can understand and obey commands. Right face twitching is observed.", a: "Focal Seizure with Preserved Consciousness (Clonic)", opts: ["Focal Seizure with Impaired Consciousness (Cognitive)", "Generalized Atonic Seizure", "Focal Seizure with Preserved Consciousness (Sensory)"] },
            { q: "Brief shock-like jerks of the upper extremities in the morning, dropping objects.", a: "Generalized Myoclonic Seizure", opts: ["Focal Motor Seizure (Tonic)", "Generalized Non-Motor Seizure (Absence)", "Focal Motor Seizure (Clonic)"] },
            { q: "Uncontrolled laughter (gelastic) without emotional affect.", a: "Focal Seizure with Impaired Consciousness (Gelastic)", opts: ["Focal Seizure with Preserved Consciousness (Emotional)", "Generalized Non-Motor Seizure", "Focal Seizure with Preserved Consciousness (Sensory)"] },
            { q: "Sensation of 'Already Seen' (Deja Vu) followed by loss of awareness and lip smacking.", a: "Focal Seizure with Impaired Consciousness (Cognitive)", opts: ["Focal Seizure with Preserved Consciousness (Cognitive)", "Generalized Absence Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Patient feels palpitations and racing heart, fully aware, no other symptoms.", a: "Focal Seizure with Preserved Consciousness (Autonomic)", opts: ["Focal Seizure with Impaired Consciousness (Autonomic)", "Generalized Motor Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Patient has piloerection (goosebumps) on the left arm, fully aware.", a: "Focal Seizure with Preserved Consciousness (Autonomic)", opts: ["Focal Seizure with Impaired Consciousness (Sensory)", "Generalized Tonic Seizure", "Focal Motor Seizure (Myoclonic)"] },
            { q: "Sudden urge to void urine followed by confusion.", a: "Focal Seizure with Impaired Consciousness (Autonomic)", opts: ["Focal Seizure with Preserved Consciousness (Autonomic)", "Generalized Atonic Seizure", "Focal Motor Seizure (Hyperkinetic)"] },
            { q: "Visual distortions where objects appear smaller (Micropsia), fully aware.", a: "Focal Seizure with Preserved Consciousness (Sensory)", opts: ["Focal Seizure with Impaired Consciousness (Cognitive)", "Generalized Sensory Seizure", "Focal Motor Seizure (Automatism)"] },
            { q: "Sudden vertigo and spinning sensation, fully aware.", a: "Focal Seizure with Preserved Consciousness (Vestibular)", opts: ["Focal Seizure with Impaired Consciousness (Autonomic)", "Generalized Motor Seizure", "Focal Motor Seizure (Versive)"] },
            { q: "Repetitive blinking of eyelids (myoclonia) with brief loss of awareness.", a: "Generalized Absence with Eyelid Myoclonia", opts: ["Focal Seizure with Preserved Consciousness", "Focal Motor Seizure (Clonic)", "Generalized Atonic Seizure"] },
            { q: "Patient stops moving, stares, and is unresponsive for 1 minute. Post-ictal confusion.", a: "Focal Seizure with Impaired Consciousness (Behavioral Arrest)", opts: ["Generalized Non-Motor Seizure (Absence)", "Focal Seizure with Preserved Consciousness", "Generalized Atonic Seizure"] },
            { q: "Rhythmic jerking of the left leg, fully aware.", a: "Focal Seizure with Preserved Consciousness (Clonic)", opts: ["Focal Seizure with Impaired Consciousness (Clonic)", "Generalized Clonic Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Sudden intense smell of burning rubber, fully aware.", a: "Focal Seizure with Preserved Consciousness (Olfactory)", opts: ["Focal Seizure with Impaired Consciousness (Sensory)", "Generalized Non-Motor Seizure", "Focal Motor Seizure (Automatism)"] },
            { q: "Sudden metallic taste in mouth, fully aware.", a: "Focal Seizure with Preserved Consciousness (Gustatory)", opts: ["Focal Seizure with Impaired Consciousness (Autonomic)", "Generalized Sensory Seizure", "Focal Motor Seizure (Gelastic)"] },
            { q: "Patient hears a buzzing sound in the left ear, fully aware.", a: "Focal Seizure with Preserved Consciousness (Auditory)", opts: ["Focal Seizure with Impaired Consciousness (Sensory)", "Generalized Non-Motor Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Patient hears complex music/voices, fully aware.", a: "Focal Seizure with Preserved Consciousness (Auditory)", opts: ["Focal Seizure with Impaired Consciousness (Cognitive)", "Generalized Sensory Seizure", "Focal Motor Seizure (Automatism)"] },
            { q: "Sensation of heat rising from abdomen to head, aware.", a: "Focal Seizure with Preserved Consciousness (Thermal)", opts: ["Focal Seizure with Impaired Consciousness (Autonomic)", "Generalized Motor Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Painful cramping sensation in the right hand, aware.", a: "Focal Seizure with Preserved Consciousness (Somatosensory)", opts: ["Focal Seizure with Impaired Consciousness (Motor)", "Generalized Tonic Seizure", "Focal Motor Seizure (Dystonic)"] },
            { q: "Numbness and tingling in the left face, aware.", a: "Focal Seizure with Preserved Consciousness (Somatosensory)", opts: ["Focal Seizure with Impaired Consciousness (Sensory)", "Generalized Sensory Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Forced thinking / racing thoughts, aware.", a: "Focal Seizure with Preserved Consciousness (Cognitive)", opts: ["Focal Seizure with Impaired Consciousness (Cognitive)", "Generalized Absence Seizure", "Focal Motor Seizure (Automatism)"] },
            { q: "Feeling of detachment from body (Depersonalization), aware.", a: "Focal Seizure with Preserved Consciousness (Cognitive)", opts: ["Focal Seizure with Impaired Consciousness (Emotional)", "Generalized Non-Motor Seizure", "Focal Motor Seizure (Hyperkinetic)"] },
            { q: "Patient begins to undress (disrobing) during a period of confusion.", a: "Focal Seizure with Impaired Consciousness (Automatism)", opts: ["Focal Seizure with Preserved Consciousness (Motor)", "Generalized Absence Seizure", "Focal Motor Seizure (Hyperkinetic)"] },
            { q: "Patient walks aimlessly in circles (ambulatory automatism), confused.", a: "Focal Seizure with Impaired Consciousness (Automatism)", opts: ["Focal Seizure with Preserved Consciousness (Motor)", "Generalized Motor Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Patient performs bicycling movements with legs while confused.", a: "Focal Seizure with Impaired Consciousness (Hyperkinetic)", opts: ["Focal Seizure with Preserved Consciousness (Tonic)", "Generalized Tonic-Clonic Seizure", "Focal Motor Seizure (Automatism)"] },
            { q: "Sudden asymmetric tonic posturing (Figure of 4), confused.", a: "Focal Seizure with Impaired Consciousness (Tonic)", opts: ["Focal Seizure with Preserved Consciousness (Motor)", "Generalized Tonic Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Patient turns head forcibly to the right, then loses consciousness.", a: "Focal Seizure with Impaired Consciousness (Versive)", opts: ["Focal Seizure with Preserved Consciousness (Motor)", "Generalized Motor Seizure", "Focal Motor Seizure (Dystonic)"] },
            { q: "Patient makes stepping movements with legs, confused.", a: "Focal Seizure with Impaired Consciousness (Automatism)", opts: ["Focal Seizure with Preserved Consciousness (Motor)", "Generalized Myoclonic Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Patient whistles repetitively, confused.", a: "Focal Seizure with Impaired Consciousness (Vocal Automatism)", opts: ["Focal Seizure with Preserved Consciousness (Cognitive)", "Generalized Non-Motor Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Patient repeats the same word/phrase (Palilalia), confused.", a: "Focal Seizure with Impaired Consciousness (Vocal Automatism)", opts: ["Focal Seizure with Preserved Consciousness (Sensory)", "Generalized Absence Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Patient screams in fear, confused.", a: "Focal Seizure with Impaired Consciousness (Emotional)", opts: ["Focal Seizure with Preserved Consciousness (Autonomic)", "Generalized Tonic Seizure", "Focal Motor Seizure (Hyperkinetic)"] },
            { q: "Patient cries tears (Dacrystic), aware.", a: "Focal Seizure with Preserved Consciousness (Dacrystic)", opts: ["Focal Seizure with Impaired Consciousness (Emotional)", "Generalized Non-Motor Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Head drop (loss of neck tone), split second.", a: "Focal or Generalized Atonic Seizure", opts: ["Focal Motor Seizure (Tonic)", "Generalized Tonic Seizure", "Focal Seizure with Impaired Consciousness"] },
            { q: "Sudden bilateral arm flexion (Spasms), in clusters.", a: "Epileptic Spasms (Focal or Generalized)", opts: ["Focal Motor Seizure (Clonic)", "Generalized Myoclonic Seizure", "Focal Seizure with Preserved Consciousness"] },
            { q: "Triggered by reading, jaw jerking occurs.", a: "Reflex Seizure (Focal or Generalized)", opts: ["Focal Seizure with Impaired Consciousness", "Generalized Absence Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Triggered by hot water on head, confused.", a: "Reflex Seizure (Focal with Impaired Consciousness)", opts: ["Focal Seizure with Preserved Consciousness", "Generalized Tonic-Clonic Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Triggered by startling noise, stiffening occurs.", a: "Reflex Seizure (Startle - Tonic)", opts: ["Focal Seizure with Impaired Consciousness", "Generalized Absence Seizure", "Focal Motor Seizure (Automatism)"] },
            { q: "Rhythmic 3Hz eyelid blink with staring.", a: "Generalized Absence with Eyelid Myoclonia", opts: ["Focal Seizure with Impaired Consciousness", "Focal Motor Seizure (Clonic)", "Generalized Tonic Seizure"] },
            { q: "Patient feels as if they are outside their body.", a: "Focal Seizure with Preserved Consciousness (Cognitive)", opts: ["Focal Seizure with Impaired Consciousness (Sensory)", "Generalized Non-Motor Seizure", "Focal Motor Seizure (Automatism)"] },
            { q: "Patient sees their own body (Autoscopy).", a: "Focal Seizure with Preserved Consciousness (Cognitive)", opts: ["Focal Seizure with Impaired Consciousness (Visual)", "Generalized Sensory Seizure", "Focal Motor Seizure (Hyperkinetic)"] },
            { q: "Patient is unable to read (Alexia) during event, aware.", a: "Focal Seizure with Preserved Consciousness (Cognitive)", opts: ["Focal Seizure with Impaired Consciousness (Language)", "Generalized Non-Motor Seizure", "Focal Motor Seizure (Automatism)"] },
            { q: "Patient is unable to write (Agraphia) during event, aware.", a: "Focal Seizure with Preserved Consciousness (Cognitive)", opts: ["Focal Seizure with Impaired Consciousness (Motor)", "Generalized Absence Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Patient cannot calculate (Acalculia), aware.", a: "Focal Seizure with Preserved Consciousness (Cognitive)", opts: ["Focal Seizure with Impaired Consciousness (Language)", "Generalized Sensory Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Left arm becomes paralyzed (negative motor), aware.", a: "Focal Seizure with Preserved Consciousness (Atonic/Inhibitory)", opts: ["Focal Seizure with Impaired Consciousness (Motor)", "Generalized Atonic Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Unable to move any limb, fully aware.", a: "Focal Seizure with Preserved Consciousness (Atonic/Inhibitory)", opts: ["Focal Seizure with Impaired Consciousness (Motor)", "Generalized Atonic Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Genital sensations (somatosensory), aware.", a: "Focal Seizure with Preserved Consciousness (Sensory)", opts: ["Focal Seizure with Impaired Consciousness (Autonomic)", "Generalized Non-Motor Seizure", "Focal Motor Seizure (Automatism)"] },
            { q: "Sexual arousal / orgasm, aware.", a: "Focal Seizure with Preserved Consciousness (Autonomic/Sensory)", opts: ["Focal Seizure with Impaired Consciousness (Emotional)", "Generalized Motor Seizure", "Focal Motor Seizure (Hyperkinetic)"] },
            { q: "Vomiting (Ictal emesis), confused.", a: "Focal Seizure with Impaired Consciousness (Autonomic)", opts: ["Focal Seizure with Preserved Consciousness (Motor)", "Generalized Tonic-Clonic Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Coughing (Ictal tussis), confused.", a: "Focal Seizure with Impaired Consciousness (Autonomic)", opts: ["Focal Seizure with Preserved Consciousness (Motor)", "Generalized Absence Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Apnea (stops breathing), confused.", a: "Focal Seizure with Impaired Consciousness (Autonomic)", opts: ["Focal Seizure with Preserved Consciousness (Sensory)", "Generalized Motor Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Hyperventilation, confused.", a: "Focal Seizure with Impaired Consciousness (Autonomic)", opts: ["Focal Seizure with Preserved Consciousness (Emotional)", "Generalized Non-Motor Seizure", "Focal Motor Seizure (Automatism)"] },
            { q: "Bradycardia / Asystole, confused.", a: "Focal Seizure with Impaired Consciousness (Autonomic)", opts: ["Focal Seizure with Preserved Consciousness (Sensory)", "Generalized Atonic Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Pupillary dilation (Mydriasis), confused.", a: "Focal Seizure with Impaired Consciousness (Autonomic)", opts: ["Focal Seizure with Preserved Consciousness (Visual)", "Generalized Motor Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Water drinking (Ictal), confused.", a: "Focal Seizure with Impaired Consciousness (Automatism)", opts: ["Focal Seizure with Preserved Consciousness (Autonomic)", "Generalized Non-Motor Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Running (Cursive), confused.", a: "Focal Seizure with Impaired Consciousness (Hyperkinetic)", opts: ["Focal Seizure with Preserved Consciousness (Motor)", "Generalized Tonic-Clonic Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Spinning (Gyratory), confused.", a: "Focal Seizure with Impaired Consciousness (Hyperkinetic)", opts: ["Focal Seizure with Preserved Consciousness (Vestibular)", "Generalized Motor Seizure", "Focal Motor Seizure (Automatism)"] },
            { q: "Biting, confused.", a: "Focal Seizure with Impaired Consciousness (Automatism)", opts: ["Focal Seizure with Preserved Consciousness (Motor)", "Generalized Tonic Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Kissing movements, confused.", a: "Focal Seizure with Impaired Consciousness (Automatism)", opts: ["Focal Seizure with Preserved Consciousness (Emotional)", "Generalized Non-Motor Seizure", "Focal Motor Seizure (Tonic)"] },
            { q: "Grimacing, aware.", a: "Focal Seizure with Preserved Consciousness (Motor)", opts: ["Focal Seizure with Impaired Consciousness (Emotional)", "Generalized Myoclonic Seizure", "Focal Motor Seizure (Hyperkinetic)"] },
            { q: "Chanting / Singing, confused.", a: "Focal Seizure with Impaired Consciousness (Vocal Automatism)", opts: ["Focal Seizure with Preserved Consciousness (Auditory)", "Generalized Absence Seizure", "Focal Motor Seizure (Clonic)"] },
            { q: "Right hand fumbling, Left hand dystonia, confused.", a: "Focal Seizure with Impaired Consciousness (Automatism/Dystonic)", opts: ["Focal Seizure with Preserved Consciousness (Motor)", "Generalized Tonic-Clonic Seizure", "Focal Motor Seizure (Clonic)"] }
        ];

        const semiologyCases = [
            { q: "A 30-year-old male presents with seizures characterized by asymmetric tonic posturing. His RIGHT arm extends while his LEFT arm flexes (Figure of 4).", a: "Left Hemisphere (Contralateral)", opts: ["Right Hemisphere (Ipsilateral)", "Bilateral Frontal Lobes", "Bilateral Occipital Lobes"] },
            { q: "A patient describes a warning of 'unpleasant smell' (burning rubber) before losing awareness.", a: "Mesial Temporal Lobe (Uncus)", opts: ["Lateral Temporal Lobe Neocortex", "Orbitofrontal Cortex Region", "Primary Occipital Cortex"] },
            { q: "During the seizure, the patient frequently spits (ictal spitting) before becoming confused.", a: "Non-Dominant Temporal Lobe", opts: ["Dominant Temporal Lobe", "Dorsolateral Frontal Lobe", "Posterior Parietal Lobe"] },
            { q: "Seizures involve intelligible speech ('I'm okay, I'm okay') despite loss of awareness later in the event.", a: "Non-Dominant Hemisphere", opts: ["Dominant Hemisphere", "Left Frontal Lobe (Broca)", "Left Temporal Lobe (Wernicke)"] },
            { q: "Patient exhibits post-ictal nose wiping consistently with the RIGHT hand.", a: "Right Hemisphere (Ipsilateral)", opts: ["Left Hemisphere (Contralateral)", "Bilateral Hemispheres", "Midline Structures"] },
            { q: "A 12-year-old presents with episodes of inappropriate, mirthless laughter (Gelastic seizures).", a: "Hypothalamus (Hamartoma)", opts: ["Hippocampus (Mesial Temporal)", "Amygdala (Mesial Temporal)", "Visual Cortex (Occipital)"] },
            { q: "Seizures consist of elementary visual hallucinations (flashing lights/spots) in the LEFT visual field.", a: "Right Occipital Lobe", opts: ["Left Occipital Lobe", "Right Temporal Lobe", "Left Frontal Lobe"] },
            { q: "Patient reports a sensation of laryngeal constriction (throat tightening) and difficulty breathing.", a: "Insular Cortex", opts: ["Hippocampus Proper", "Pre-frontal Cortex", "Primary Occipital Cortex"] },
            { q: "Seizures are sleep-related and involve violent hypermotor behavior (bicycling/thrashing).", a: "Frontal Lobe (Ventromesial)", opts: ["Lateral Temporal Lobe", "Primary Occipital Lobe", "Posterior Parietal Lobe"] },
            { q: "Patient assumes a 'Fencing Posture' (head turned, one arm extended, one flexed) during the seizure.", a: "Supplementary Motor Area (SMA)", opts: ["Mesial Temporal Lobe", "Primary Visual Cortex", "Inferior Frontal Gyrus"] },
            { q: "Patient has ictal vomiting (emesis) followed by deviation of eyes to the left.", a: "Right Temporal Lobe (Non-Dominant)", opts: ["Left Temporal Lobe", "Left Frontal Lobe", "Right Occipital Lobe"] },
            { q: "Seizure begins with a rising epigastric sensation (butterflies in stomach).", a: "Mesial Temporal Lobe", opts: ["Lateral Temporal Lobe", "Frontal Pole Region", "Posterior Parietal Lobe"] },
            { q: "Patient hears simple buzzing or ringing sounds (Auditory Hallucination).", a: "Superior Temporal Gyrus (Heschl's)", opts: ["Inferior Temporal Gyrus", "Dorsolateral Frontal Lobe", "Primary Occipital Lobe"] },
            { q: "Patient reports a metallic or acidic taste (Gustatory Hallucination).", a: "Insula / Parietal Operculum", opts: ["Primary Occipital Lobe", "Frontal Pole Region", "Mesial Temporal Lobe"] },
            { q: "Sudden onset of inability to do math (Acalculia) during the event.", a: "Left Parietal Lobe (Angular Gyrus)", opts: ["Right Parietal Lobe", "Frontal Lobe Region", "Temporal Lobe Region"] },
            { q: "Patient perceives objects as shrinking or growing (Macropsia/Micropsia - Alice in Wonderland).", a: "Temporo-Occipital / Parietal", opts: ["Frontal Lobe Region", "Insular Cortex", "Primary Motor Cortex"] },
            { q: "Seizure involves repetitive genital manipulation or sexual automatisms.", a: "Non-Dominant Orbitofrontal / Mesial", opts: ["Dominant Temporal Lobe", "Primary Occipital Lobe", "Posterior Parietal Lobe"] },
            { q: "Patient has a 'Drop Attack' (sudden loss of tone) without loss of consciousness.", a: "Frontal / Generalized Network", opts: ["Mesial Temporal Lobe", "Primary Occipital Lobe", "Insular Cortex"] },
            { q: "Ictal Pouting (Chapeau de gendarme) - downturning of mouth corners.", a: "Frontal Operculum / Insula", opts: ["Primary Occipital Lobe", "Mesial Temporal Lobe", "Posterior Parietal Lobe"] },
            { q: "Patient experiences a strong urge to urinate (Ictal Urinary Urge).", a: "Non-Dominant Temporal Lobe", opts: ["Dominant Temporal Lobe", "Frontal Lobe Region", "Primary Occipital Lobe"] },
            { q: "Forced Head Turn (Version) to the LEFT.", a: "Right Frontal Lobe", opts: ["Left Frontal Lobe", "Right Temporal Lobe", "Left Occipital Lobe"] },
            { q: "Forced Head Turn (Version) to the RIGHT.", a: "Left Frontal Lobe", opts: ["Right Frontal Lobe", "Left Temporal Lobe", "Right Occipital Lobe"] },
            { q: "Unilateral Dystonic Posturing of the LEFT hand.", a: "Right Hemisphere (Contralateral)", opts: ["Left Hemisphere (Ipsilateral)", "Bilateral Frontal Lobes", "Bilateral Occipital Lobes"] },
            { q: "Unilateral Dystonic Posturing of the RIGHT hand.", a: "Left Hemisphere (Contralateral)", opts: ["Right Hemisphere (Ipsilateral)", "Bilateral Frontal Lobes", "Bilateral Occipital Lobes"] },
            { q: "Focal Clonic Jerking of the LEFT arm.", a: "Right Motor Cortex", opts: ["Left Motor Cortex", "Right Occipital Lobe", "Left Temporal Lobe"] },
            { q: "Focal Clonic Jerking of the RIGHT arm.", a: "Left Motor Cortex", opts: ["Right Motor Cortex", "Left Occipital Lobe", "Right Temporal Lobe"] },
            { q: "Ictal Aphasia (unable to speak/understand).", a: "Dominant Hemisphere (usually Left)", opts: ["Non-Dominant Hemisphere", "Right Frontal Lobe", "Right Occipital Lobe"] },
            { q: "Visual Hallucinations of complex scenes (people, faces).", a: "Basal Temporal / Occipito-temporal", opts: ["Primary Visual Cortex (V1)", "Dorsolateral Frontal", "Primary Motor Cortex"] },
            { q: "Ictal Asystole (heart pause).", a: "Left Temporal Lobe (Insula link)", opts: ["Right Temporal Lobe", "Primary Occipital Lobe", "Posterior Parietal Lobe"] },
            { q: "Ictal Bradycardia.", a: "Left Temporal Lobe (Insula link)", opts: ["Right Temporal Lobe", "Primary Occipital Lobe", "Posterior Parietal Lobe"] },
            { q: "Ictal Tachycardia (heart racing).", a: "Right Temporal / Insula", opts: ["Primary Occipital Lobe", "Primary Motor Cortex", "Posterior Parietal Lobe"] },
            { q: "Piloerection (Goosebumps) - Unilateral.", a: "Ipsilateral Hemisphere (Insula)", opts: ["Contralateral Hemisphere", "Bilateral Occipital", "Midline Structures"] },
            { q: "Ictal Pain (burning/stinging).", a: "Insular Cortex (Posterior)", opts: ["Hippocampus Proper", "Dorsolateral Frontal", "Primary Occipital Lobe"] },
            { q: "Feeling of cold / heat (Thermal).", a: "Insular Cortex / Parietal", opts: ["Primary Occipital Lobe", "Mesial Temporal Lobe", "Frontal Pole Region"] },
            { q: "Nystagmus with rapid phase to the LEFT.", a: "Right Posterior Hemisphere", opts: ["Left Posterior Hemisphere", "Right Frontal Lobe", "Left Frontal Lobe"] },
            { q: "Nystagmus with rapid phase to the RIGHT.", a: "Left Posterior Hemisphere", opts: ["Right Posterior Hemisphere", "Left Frontal Lobe", "Right Frontal Lobe"] },
            { q: "Eye Deviation (Oculogyric) to the LEFT.", a: "Right Frontal Lobe", opts: ["Left Frontal Lobe", "Right Temporal Lobe", "Left Occipital Lobe"] },
            { q: "Eye Deviation (Oculogyric) to the RIGHT.", a: "Left Frontal Lobe", opts: ["Right Frontal Lobe", "Left Temporal Lobe", "Right Occipital Lobe"] },
            { q: "Akinetic Mutism (silent, immobile).", a: "Medial Frontal (Cingulate/SMA)", opts: ["Lateral Temporal Lobe", "Primary Occipital Lobe", "Posterior Parietal Lobe"] },
            { q: "Autoscopic Hallucination (seeing double of self).", a: "Temporo-Parietal Junction", opts: ["Dorsolateral Frontal", "Primary Motor Cortex", "Insular Cortex"] },
            { q: "Out of Body Experience (floating above).", a: "Temporo-Parietal Junction", opts: ["Dorsolateral Frontal", "Primary Motor Cortex", "Insular Cortex"] },
            { q: "Depersonalization (detached from reality).", a: "Temporal Lobe (Limbic)", opts: ["Primary Occipital Lobe", "Primary Motor Cortex", "Dorsolateral Frontal"] },
            { q: "Prosopagnosia (unable to recognize faces).", a: "Fusiform Gyrus (Occipito-temporal)", opts: ["Dorsolateral Frontal", "Primary Motor Cortex", "Insular Cortex"] },
            { q: "Topographic Agnosia (lost in familiar places).", a: "Non-Dominant Parietal/Occipital", opts: ["Dominant Frontal Lobe", "Primary Motor Cortex", "Insular Cortex"] },
            { q: "Finger Agnosia (can't identify fingers).", a: "Dominant Parietal (Gerstmann)", opts: ["Non-Dominant Parietal", "Primary Occipital Lobe", "Frontal Pole Region"] },
            { q: "Right-Left Confusion.", a: "Dominant Parietal (Gerstmann)", opts: ["Non-Dominant Parietal", "Primary Occipital Lobe", "Frontal Pole Region"] },
            { q: "Agraphia (unable to write).", a: "Dominant Parietal (Gerstmann)", opts: ["Non-Dominant Parietal", "Primary Occipital Lobe", "Frontal Pole Region"] },
            { q: "Dressing Apraxia.", a: "Non-Dominant Parietal", opts: ["Dominant Parietal", "Primary Occipital Lobe", "Frontal Pole Region"] },
            { q: "Constructional Apraxia.", a: "Non-Dominant Parietal", opts: ["Dominant Parietal", "Primary Occipital Lobe", "Frontal Pole Region"] },
            { q: "Phantom Limb Sensation.", a: "Parietal Lobe (Post-central)", opts: ["Frontal Lobe Region", "Temporal Lobe Region", "Occipital Lobe Region"] },
            { q: "Asomatognosia (denial of limb ownership).", a: "Non-Dominant Parietal", opts: ["Dominant Parietal", "Primary Occipital Lobe", "Frontal Pole Region"] },
            { q: "Ictal Biting.", a: "Frontal Operculum / Insula", opts: ["Primary Occipital Lobe", "Mesial Temporal Lobe", "Posterior Parietal Lobe"] },
            { q: "Ictal Kissing.", a: "Temporal / Frontal Operculum", opts: ["Primary Occipital Lobe", "Posterior Parietal Lobe", "Primary Motor Cortex"] },
            { q: "Running seizures (Cursive).", a: "Frontal / Temporal", opts: ["Primary Occipital Lobe", "Posterior Parietal Lobe", "Insular Cortex"] },
            { q: "Spinning seizures (Gyratory).", a: "Frontal / Temporal", opts: ["Primary Occipital Lobe", "Posterior Parietal Lobe", "Insular Cortex"] },
            { q: "Water Drinking.", a: "Temporal Lobe", opts: ["Frontal Lobe Region", "Primary Occipital Lobe", "Posterior Parietal Lobe"] },
            { q: "Reflex Seizure (Musicogenic).", a: "Superior Temporal Gyrus", opts: ["Primary Occipital Lobe", "Inferior Frontal Gyrus", "Posterior Parietal Lobe"] },
            { q: "Reflex Seizure (Reading).", a: "Dominant Pre-central / Temporal", opts: ["Primary Occipital Lobe", "Right Frontal Lobe", "Posterior Parietal Lobe"] },
            { q: "Reflex Seizure (Hot Water).", a: "Parietal / Temporal", opts: ["Primary Occipital Lobe", "Frontal Pole Region", "Primary Motor Cortex"] },
            { q: "Reflex Seizure (Eating).", a: "Temporo-Limbic / Insula", opts: ["Primary Occipital Lobe", "Primary Motor Cortex", "Posterior Parietal Lobe"] },
            { q: "Startle Seizure (Sound/Touch).", a: "SMA / Motor Cortex", opts: ["Primary Occipital Lobe", "Mesial Temporal Lobe", "Inferior Temporal Gyrus"] },
            { q: "Palilalia (repeating words).", a: "Medial Frontal / SMA", opts: ["Primary Occipital Lobe", "Posterior Parietal Lobe", "Insular Cortex"] },
            { q: "Ictal Whistling.", a: "Frontal Lobe / Cingulate", opts: ["Primary Occipital Lobe", "Posterior Parietal Lobe", "Insular Cortex"] },
            { q: "Apnea (stops breathing).", a: "Temporal / Limbic", opts: ["Primary Occipital Lobe", "Primary Motor Cortex", "Posterior Parietal Lobe"] },
            { q: "Hyperventilation.", a: "Mesial Temporal / Frontal", opts: ["Primary Occipital Lobe", "Primary Motor Cortex", "Posterior Parietal Lobe"] },
            { q: "Ictal Coughing.", a: "Temporal / Frontal", opts: ["Primary Occipital Lobe", "Primary Motor Cortex", "Posterior Parietal Lobe"] },
            { q: "Mydriasis (Pupil dilation).", a: "Frontal / Temporal (Autonomic)", opts: ["Primary Occipital Lobe", "Primary Motor Cortex", "Posterior Parietal Lobe"] },
            { q: "Genital Somatosensory.", a: "Paracentral Lobule", opts: ["Lateral Temporal Lobe", "Primary Occipital Lobe", "Frontal Pole Region"] },
            { q: "Sexual Arousal / Orgasm.", a: "Non-Dominant Temporal / Frontal", opts: ["Primary Occipital Lobe", "Primary Motor Cortex", "Posterior Parietal Lobe"] },
            { q: "Ecstatic Seizure (Bliss).", a: "Anterior Insula", opts: ["Posterior Insula", "Primary Occipital Lobe", "Primary Motor Cortex"] }
        ];

        let quizQuestions = [];
        let currentQIndex = 0;
        let streak = 0;

        function startQuiz(type) {
            // Select Question Set
            if (type === 'classification') {
                quizQuestions = [...classificationCases];
                document.getElementById('quizTitle').textContent = "ILAE Classification Test";
            } else {
                quizQuestions = [...semiologyCases];
                document.getElementById('quizTitle').textContent = "Seizure Semiology Test";
            }
            
            // Randomize order
            quizQuestions.sort(() => Math.random() - 0.5);
            
            currentQIndex = 0;
            streak = 0;
            
            // UI Transition
            document.getElementById('quizMenu').classList.add('hidden');
            document.getElementById('quizActive').classList.remove('hidden');
            document.getElementById('quizActive').classList.add('flex');
            
            renderQuestion();
        }

        function renderQuestion() {
            const q = quizQuestions[currentQIndex];
            document.getElementById('qCount').textContent = `Question ${currentQIndex + 1} / ${quizQuestions.length}`;
            document.getElementById('qStreak').textContent = `Streak: ${streak} üî•`;
            document.getElementById('qText').textContent = q.q;
            document.getElementById('qFeedback').classList.add('hidden');
            
            const options = [q.a, ...q.opts].sort(() => Math.random() - 0.5);
            const container = document.getElementById('qOptions');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "w-full p-4 text-left border-2 border-slate-200 rounded-lg transition-all font-medium text-slate-700 hover:border-primary hover:bg-slate-50";
                btn.textContent = opt;
                btn.onclick = () => handleAnswer(btn, opt, q.a);
                container.appendChild(btn);
            });
            
            // Scroll to top of active view
            document.getElementById('quizActive').scrollTo(0, 0);
        }

        function handleAnswer(btn, selected, correct) {
            const btns = document.querySelectorAll('#qOptions button');
            btns.forEach(b => b.disabled = true);
            
            const fb = document.getElementById('qFeedback');
            const fbText = document.getElementById('feedbackText');
            
            if (selected === correct) {
                btn.className = "w-full p-4 text-left border-2 rounded-lg transition-all font-medium text-green-800 bg-green-50 border-green-500 relative";
                btn.innerHTML += '<span class="absolute right-4 top-1/2 -translate-y-1/2 text-2xl">‚úÖ</span>';
                fbText.textContent = "Correct!";
                fbText.className = "text-lg font-bold text-green-600";
                streak++;
            } else {
                btn.className = "w-full p-4 text-left border-2 rounded-lg transition-all font-medium text-red-800 bg-red-50 border-red-500 relative";
                btn.innerHTML += '<span class="absolute right-4 top-1/2 -translate-y-1/2 text-2xl">‚ùå</span>';
                btns.forEach(b => {
                    if (b.textContent === correct) {
                        b.className = "w-full p-4 text-left border-2 rounded-lg transition-all font-medium text-green-800 bg-green-50 border-green-500 relative";
                         b.innerHTML += '<span class="absolute right-4 top-1/2 -translate-y-1/2 text-2xl">‚úÖ</span>';
                    }
                });
                fbText.textContent = `Incorrect.`;
                fbText.className = "text-lg font-bold text-red-600";
                streak = 0;
            }
            fb.classList.remove('hidden');
        }

        function nextQuestion() {
            if (currentQIndex < quizQuestions.length - 1) {
                currentQIndex++;
                renderQuestion();
            } else {
                alert(`Module Complete! Final Streak: ${streak}`);
                showQuizMenu();
            }
        }
    </script>
</body>
</html>